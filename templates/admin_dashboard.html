{% extends "adminbase.html" %}

{% block content %}

<style>
/* GOOGLE FONT */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

body { font-family: 'Inter', sans-serif; }

/* PAGE TITLE */
.page-title {
    font-size: 26px;
    font-weight: 600;
    color: #1a237e;
    margin-bottom: 20px;
}

/* ---------- STAT CARDS ---------- */
.dashboard {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 22px;
    margin-bottom: 35px;
}

.card {
    background: #ffffff;
    padding: 22px;
    border-radius: 18px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.07);
    transition: all 0.2s ease;
    border: 1px solid #e8eaf6;
}

.card:hover {
    box-shadow: 0 10px 28px rgba(0,0,0,0.12);
    transform: translateY(-4px);
}

.card small { color: #616161; }
.card h2 { font-size: 36px; margin-top: 6px; color: #1a237e; }

/* ---------- CHART CONTAINERS ---------- */
.chart-container {
    background: white;
    padding: 24px;
    border-radius: 18px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.08);
    margin-top: 26px;
    border: 1px solid #e6e8f5;
}

.chart-container canvas {
    max-height: 320px !important;
}

/* GRID FOR TWO CHARTS */
.chart-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
    gap: 22px;
    margin-top: 26px;
}

/* ---------- TABLE ---------- */
.recent-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 16px;
}

.recent-table th {
    background: #e8eaf6;
    color: #1a237e;
    padding: 12px;
    text-align: left;
}

.recent-table td {
    padding: 11px;
    border-bottom: 1px solid #e0e0e0;
}

.recent-table tr:hover { background: #f4f6ff; }


/* ========================================================= */
/*                       DARK MODE                           */
/* ========================================================= */

.dark-mode .page-title {
    color: #bbd0ff;
}

/* Cards */
.dark-mode .card {
    background: #1e1f26 !important;
    border-color: #2c2d38 !important;
    box-shadow: none !important;
}
.dark-mode .card small { color: #c9c9c9 !important; }
.dark-mode .card h2 { color: #90caf9 !important; }

/* Chart containers */
.dark-mode .chart-container {
    background: #1e1f26 !important;
    border-color: #2c2d38 !important;
    color: #fff !important;
}

/* Table */
.dark-mode .recent-table th {
    background: #2c2d38 !important;
    color: #bbd0ff !important;
}
.dark-mode .recent-table td {
    background: #1e1f26 !important;
    color: #e2e2e2 !important;
    border-color: #3a3b47 !important;
}
.dark-mode .recent-table tr:hover {
    background: #2a2b34 !important;
}

</style>


<div class="page-title">Admin Dashboard</div>

<!-- ===== STAT CARDS ===== -->
<div class="dashboard">
    <div class="card">
        <small>Total Students</small>
        <h2>{{ total_students }}</h2>
    </div>

    <div class="card">
        <small>Courses</small>
        <h2>4</h2>
    </div>

    <div class="card">
        <small>Enrolled</small>
        <h2>{{ total_enrolled }}</h2>
    </div>
</div>

<!-- ===== CHARTS ===== -->
<div class="chart-grid">

    <div class="chart-container">
        <h3>Gender Distribution</h3>
        <canvas id="genderChart"></canvas>
    </div>

    <div class="chart-container">
        <h3>Course Distribution</h3>
        <canvas id="courseChart"></canvas>
    </div>

</div>

<!-- ===== RECENT SUBMISSIONS ===== -->
<div class="chart-container" style="margin-top: 30px;">
    <h3>Recently Submitted Applications</h3>

    <table class="recent-table">
        <thead>
            <tr>
                <th>Application ID</th>
                <th>Name</th>
                <th>Program</th>
                <th>Date Submitted</th>
            </tr>
        </thead>
        <tbody>
        {% for r in recent_submitted %}
            <tr>
                <td>{{ r.app_id }}</td>
                <td>{{ r.first_name }} {{ r.last_name }}</td>
                <td>{{ r.program }}</td>
                <td>{{ r.created_at }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
// Auto-apply chart theme based on dark-mode
function getChartTextColor() {
    return document.documentElement.classList.contains("dark-mode")
        ? "#e2e2e2"
        : "#1a237e";
}

// ----------- GENDER PIE -----------
new Chart(document.getElementById("genderChart"), {
    type: "pie",
    data: {
        labels: ["Male", "Female"],
        datasets: [{
            data: {{ [male_count, female_count] | tojson }},
            backgroundColor: ["#5c6bc0", "#f06292"],
            hoverOffset: 8
        }]
    },
    options: {
        plugins: {
            legend: { labels: { color: getChartTextColor() } }
        }
    }
});

// ----------- COURSE PIE -----------
new Chart(document.getElementById("courseChart"), {
    type: "pie",
    data: {
        labels: {{ courses | tojson | safe }},
        datasets: [{
            data: {{ course_counts | tojson | safe }},
            backgroundColor: ["#64b5f6", "#81c784", "#ffb74d", "#ba68c8"],
            hoverOffset: 10
        }]
    },
    options: {
        plugins: {
            legend: { labels: { color: getChartTextColor() } }
        }
    }
});
</script>
{% endblock %}

