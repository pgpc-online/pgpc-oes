{% extends "formbase.html" %}
{% block title %}Admin – Application Preview{% endblock %}

{% block content %}
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">

<style>
/* ---------------- GLOBAL ---------------- */
:root {
    --page-width: 760px;
    --box-border: 1px solid #000;
}

body {
    font-family: Inter, Helvetica, sans-serif;
    background: #fff;
    padding: 24px;
    margin: 0;
    color: #111;
}

.page {
    width: var(--page-width);
    max-width: 100%;
    margin: 0 auto;
    border: var(--box-border);
    padding: 20px;
    background: white;
}


@media print {
    body, html {
        margin: 0;
        padding: 0;
        width: 210mm;
        height: 297mm;
        overflow: hidden;
    }
    body * { visibility: hidden; }
    .page, .page * { visibility: visible; }

    .page {
        position: absolute;
        top: 0; left: 0;
        width: 210mm;
        height: 297mm;
        padding: 0;
        margin: 0;
        border: none;
        font-size: 10px;
    }

    .controls { display: none !important; }
}

/* ---------------- HEADER ---------------- */
.header {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
}

.school-logo {
    width: 72px;
    height: 72px;
    border-radius: 6px;
    object-fit: cover;
}

.sep {
    border: 2px solid #000;
    margin: 12px 0 14px;
}

.form-title {
    text-align: center;
    font-size: 18px;
    font-weight: 600;
    margin: 6px 0 12px;
}

/* ---------------- GRID + BOXES ---------------- */
.c1 { display: flex; width: 100%; }
.c1-box {
    border: var(--box-border);
    padding: 4px 6px;
    min-height: 30px;
    width: 100%;
    display: flex;
    align-items: center;
    gap: 4px;
}
.c1-label { font-weight: 700; font-size: 13px; white-space: nowrap; }
.c1-value { flex: 1; font-size: 13px; }

/* 2-column & 4-column rows */
.row-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 8px; }
.row-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 10px; }

/* ---------------- NAME BOXES ---------------- */
.name-photo { display: flex; gap: 16px; margin-top: 12px; }
.name-col { flex: 1; }
.name-row { display: flex; gap: 12px; align-items: center; margin-bottom: 8px; }
.name-label { width: auto; font-weight: 700; font-size: 13px; }

.name-grid {
    display: grid;
    grid-template-columns: repeat(18, 22px);
    grid-auto-rows: 22px;
}
.name-grid div {
    border: 1px solid #000;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 12px;
}

/* PHOTO */
.photo-box {
    width: 120px;
    height: 120px;
    border: 1px solid #000;
    padding: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
}
.photo-box img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* ---------------- PARENTS + ACADEMIC ---------------- */
.parent-grid, .acad-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
    margin-top: 12px;
}

.parent-box, .acad-box {
    border: 1px solid #000;
    padding: 6px;
}
.parent-box label, .acad-box label {
    font-weight: 700;
    font-size: 13px;
}
.parent-line, .acad-line {
    border: 1px solid #000;
    padding: 6px;
    min-height: 24px;
}

/* ---------------- CONTROLS ---------------- */
.controls {
    display: flex;
    justify-content: center;
    gap: 12px;
    margin-top: 16px;
}
.btn {
    padding: 8px 14px;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
}
.btn.edit { background: #fff; border: 1px solid #2d4ea0; color: #2d4ea0; }
.btn.save { background: #2d8a2d; color: white; }
.btn.print { background: #3a5fcf; color: white; }
@media print {
    .document-section { display:none !important; }
}
.phone-grid {
    display: grid;
    grid-template-columns: repeat(11, 20px); /* 11 boxes side by side */
    gap: 4px;
}
.phone-grid div {
    border: 1px solid #000;
    height: 22px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
}
</style>

<div class="page">

    <!-- HEADER -->
    <div class="header">
        <img src="{{ url_for('static', filename='images/schoollogo.jpg') }}" class="school-logo">
        <div style="text-align:center;">
            <div style="font-weight:700;">PADRE GARCIA POLYTECHNIC COLLEGE</div>
            <div style="font-size:13px;">Brgy. Castillo, Padre Garcia Batangas 4224</div>
            <div style="font-size:13px;">padregarciapolytechniccollege@gmail.com</div>
        </div>
    </div>

    <hr class="sep">

    <div class="form-title">COLLEGE ADMISSION APPLICATION FORM</div>

    <!-- PROGRAM + DATE -->
    <div class="row-2">
        <div class="c1"><div class="c1-box"><div class="c1-label">Program (Course)</div><div class="c1-value">{{ form.get('program','') }}</div></div></div>
        <div class="c1"><div class="c1-box"><div class="c1-label">Date of Application</div><div class="c1-value">{{ form.get('doa','') }}</div></div></div>
    </div>

    <!-- NAME + PHOTO -->
    <div class="name-photo">
        <div class="name-col">

            {% for field, label in [('lastName','LAST NAME'), ('firstName','FIRST NAME'), ('middleName','MIDDLE NAME')] %}
            <div class="name-row">
                <div class="name-label">{{ label }}</div>
                <div class="name-grid">
                    {% set v = (form.get(field,'') or '')[:18] %}
                    {% for i in range(18) %}
                    <div>{{ v[i:i+1]|upper if v|length > i else '' }}</div>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}

        </div>

        <div class="photo-box">
            {% if photo_filename %}
                <img src="{{ url_for('uploaded_file', filepath=photo_filename) }}">
            {% else %}
                <img src="{{ url_for('static', filename='images/picture.png') }}">
            {% endif %}
        </div>
    </div>

    <!-- DOB + POB -->
    <div class="row-2">
        <div class="c1"><div class="c1-box"><div class="c1-label">Date of Birth</div><div class="c1-value">{{ form.get('dob','') }}</div></div></div>
        <div class="c1"><div class="c1-box"><div class="c1-label">Place of Birth</div><div class="c1-value">{{ form.get('pob','') }}</div></div></div>
    </div>

    <!-- GENDER / STATUS / NAT / REL -->
    <div class="row-4">
        {% for field, label in [('gender','Sex'),('civil_status','Civil Status'),('nationality','Nationality'),('religion','Religion')] %}
        <div class="c1"><div class="c1-box"><div class="c1-label">{{ label }}</div><div class="c1-value">{{ form.get(field,'') }}</div></div></div>
        {% endfor %}
    </div>

    <!-- ADDRESS -->
    <div class="row-2">
        <div class="c1">
            <div class="c1-box">
                <div class="c1-label">Home Address</div>
                <div class="c1-value">
                    {{ form.get('street','') }}
                    {% if form.get('barangay') %}, {{ form.get('barangay') }}{% endif %}
                    {% if form.get('city') %}, {{ form.get('city') }}{% endif %}
                    {% if form.get('province') %}, {{ form.get('province') }}{% endif %}
                </div>
            </div>
        </div>
        <div class="c1"><div class="c1-box"><div class="c1-label">Postal Code</div><div class="c1-value">{{ form.get('zipcode','') }}</div></div></div>
    </div>

    <!-- PHONE + EMAIL -->
    <div style="margin-top:10px;">
        <div style="display:flex; align-items:center; gap:12px;">
            <div style="width:120px; font-weight:700;">PHONE NO.</div>
            <div class="phone-grid">
                {% set phone = (form.get('studphone','') or '')[:11] %}
                {% for i in range(11) %}
                <div style="border:1px solid #000; padding:4px; text-align:center;">
                    {{ phone[i:i+1] if phone|length>i else '' }}
                </div>
                {% endfor %}
            </div>
        </div>

        <div style="display:flex; gap:12px; margin-top:8px;">
            <div style="width:120px; font-weight:700;">EMAIL</div>
            <div style="flex:1; border:1px solid #000; padding:8px;">{{ form.get('email','') }}</div>
        </div>
    </div>

    <!-- PARENTS INFO -->
    <div class="parent-grid">
        <div class="parent-box">
            <label>Father’s Name</label><div class="parent-line">{{ form.get('fatherName','') }}</div>
            <label>Occupation</label><div class="parent-line">{{ form.get('fatherOccupation','') }}</div>
            <label>Address</label><div class="parent-line">{{ form.get('fatherAddress','') }}</div>
            <label>Contact</label><div class="parent-line">{{ form.get('fatherPhone','') }}</div>
        </div>

        <div class="parent-box">
            <label>Mother’s Maiden Name</label><div class="parent-line">{{ form.get('motherName','') }}</div>
            <label>Occupation</label><div class="parent-line">{{ form.get('motherOccupation','') }}</div>
            <label>Address</label><div class="parent-line">{{ form.get('motherAddress','') }}</div>
            <label>Contact</label><div class="parent-line">{{ form.get('motherPhone','') }}</div>
        </div>

        <div class="parent-box">
            <label>Guardian</label><div class="parent-line">{{ form.get('guardianName','') }}</div>
            <label>Occupation</label><div class="parent-line">{{ form.get('guardianOccupation','') }}</div>
            <label>Address</label><div class="parent-line">{{ form.get('guardianAddress','') }}</div>
            <label>Contact</label><div class="parent-line">{{ form.get('guardianPhone','') }}</div>
        </div>
    </div>

    <!-- INCOME -->
    <div style="margin-top:10px; display:flex; gap:12px;">
        <div style="width:120px; font-weight:700;">Monthly Income</div>
        <div style="flex:1; border:1px solid #000; padding:8px;">{{ form.get('income','') }}</div>
    </div>

    <!-- ACADEMIC -->
    <div class="acad-grid">
        <div class="acad-box">
            <label>Senior High School Strand</label><div class="acad-line">{{ form.get('strand','') }}</div>
            <label>SHS Name</label><div class="acad-line">{{ form.get('shsName','') }}</div>
            <label>SHS Address</label><div class="acad-line">{{ form.get('shsAddress','') }}</div>
            <label>Inclusive Dates</label><div class="acad-line">{{ form.get('inclusiveDates','') }}</div>
        </div>

        <div class="acad-box">
            <label>College / ALS (if any)</label><div class="acad-line">{{ form.get('cAls','') }}</div>
            <label>School Name</label><div class="acad-line">{{ form.get('cschoolName','') }}</div>
            <label>Address</label><div class="acad-line">{{ form.get('cschoolAddress','') }}</div>
            <label>Inclusive Dates</label><div class="acad-line">{{ form.get('cinclusivedates','') }}</div>
            <label>Program</label><div class="acad-line">{{ form.get('cprogram','') }}</div>
        </div>

        <div class="acad-box">
            <label>Member of Cultural Minority Group?</label>
            <div class="acad-line">
                No {% if form.get('culturalMinority') == 'No' %}✔️{% endif %}
                &nbsp;&nbsp;
                Yes {% if form.get('culturalMinority') == 'Yes' %}✔️{% endif %}
            </div>

            <label>Physical Disability?</label>
            <div class="acad-line">
                No {% if form.get('disability') == 'No' %}✔️{% endif %}
                &nbsp;&nbsp;
                Yes {% if form.get('disability') == 'Yes' %}✔️{% endif %}
            </div>

            {% if form.get('disability_details') %}
            <label>(Specify)</label>
            <div class="acad-line">{{ form.get('disability_details','') }}</div>
            {% endif %}
        </div>
    </div>
<!-- ============================= -->
<!--   DOCUMENT THUMBNAIL VIEWER   -->
<!-- ============================= -->
<div class="document-section" style="margin-top:25px;">

    <h3 style="font-size:18px; font-weight:700; margin-bottom:12px;">
        Uploaded Documents
    </h3>

    <div style="display:flex; gap:18px; flex-wrap:wrap;">

        {% for key, label in {
            "psa":"PSA Birth Certificate",
            "form138":"Form 138 (Report Card)",
            "goodmoral":"Certificate of Good Moral"
        }.items() %}

        <div style="width:240px;">
            <div style="font-weight:600; margin-bottom:6px;">{{ label }}</div>

            <div style="border:1px solid #aaa; border-radius:8px; overflow:hidden; height:160px; display:flex; align-items:center; justify-content:center; background:#fff;">
                {% if documents.get(key) %}
                    
                    {% set ext = documents.get(key).split('.')[-1].lower() %}
                    
                    {% if ext in ['jpg','jpeg','png','gif','bmp','webp'] %}
                        <img src="{{ url_for('uploaded_file', filepath=documents.get(key)) }}"
                             style="width:100%; height:100%; object-fit:cover;">
                    
                    {% else %}
                        <div style="font-size:14px; text-align:center; color:#666;">
                            PDF Document<br>(Preview not available)
                        </div>
                    {% endif %}

                {% else %}
                    <div style="font-size:14px; text-align:center; color:#999;">
                        No file uploaded
                    </div>
                {% endif %}
            </div>

            {% if documents.get(key) %}
            <div style="margin-top:8px; display:flex; gap:8px;">
                <a href="{{ url_for('uploaded_file', filepath=documents.get(key)) }}"
                   target="_blank"
                   style="padding:6px 10px; background:#1A73E8; color:white; border-radius:6px; font-size:13px; text-decoration:none;">
                   View
                </a>

                <a href="{{ url_for('uploaded_file', filepath=documents.get(key)) }}"
                   download
                   style="padding:6px 10px; background:#4caf50; color:white; border-radius:6px; font-size:13px; text-decoration:none;">
                   Download
                </a>
            </div>
            {% endif %}
        </div>

        {% endfor %}

    </div>
</div>
    <!-- CONTROLS -->
    <div class="controls">
        <a href="{{ url_for('form_page') }}?app_id={{ app_id }}">
            <button class="btn edit">Edit Form</button>
        </a>

        <form action="{{ url_for('admin_save_student', app_id=app_id) }}" method="POST">
            <button class="btn save" type="submit">
                Save Changes
            </button>
        </form>

        <button class="btn print" onclick="window.print()">Print</button>
    </div>

</div>
{% endblock %}







